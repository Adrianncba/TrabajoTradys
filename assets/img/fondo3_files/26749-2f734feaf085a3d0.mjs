(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[26749],{121630:(e,t,a)=>{a.d(t,{Z:()=>n,e:()=>s});var i=a(81226);const s=e=>{if("undefined"==typeof window)return"";let t=0;const a=document.querySelector('[data-test-id="header"]');if(null!==a){const{height:e}=a.getBoundingClientRect();t+=e}switch(e){case"AuthHomefeed":const e=document.querySelector('[data-root-margin="more-ideas-tabs"]');if(null!==e){const{height:a}=e.getBoundingClientRect();t+=a}break;case"SearchItem":const a=document.querySelector('[data-root-margin="search-improvements-bar"]');if(null!==a){const{height:e}=a.getBoundingClientRect();t+=e}const i=document.querySelector('[data-test-id="search-tab-bar"],[data-root-margin="search-one-bar"]');if(null!==i){const{height:e}=i.getBoundingClientRect();t+=e}}return-1*t+"px 0px 0px 0px"},n=e=>{var t,a,s,n,o;return(0,i.Z)((null===(t=e.videos)||void 0===t?void 0:t.duration)||(null===(a=e.videos)||void 0===a||null===(s=a.video_list)||void 0===s||null===(n=s.V_HLSV4)||void 0===n?void 0:n.duration)||(null===(o=e.story_pin_data)||void 0===o?void 0:o.total_video_duration)||0)}},926749:(e,t,a)=>{a.d(t,{ZP:()=>D});var i=a(667294),s=a(23279),n=a.n(s),o=a(722767);function r(e){const{eventData:{videoEvent:{videoDuration:t,startTime:a,endTime:i,videoStartTime:s,videoEndTime:n,isAudible:o,height:r,width:l,playbackState:d,quartile:h,quartilePercentValue:c,windowHeight:u,windowWidth:p,viewability:y}},component:m,objectId:b,view:v,viewParameter:g,...P}=e;return{component:m,object_id_str:b,view_type:v,view_parameter:g,aux_data:{...P},event_data:{videoEventData:{videoDuration:t,time:a,endTime:i,videoTime:s,endVideoTime:n,isAudible:o,height:r,width:l,playbackState:d,quartile:h,quartilePercentValue:c,windowHeight:u,windowWidth:p,viewability:y}}}}var l=a(121630),d=a(944546),h=a(407043),c=a(158103),u=a(883119),p=a(785893);function y(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const m=[0,.25,.5,.75,.95,.97],b=[0,.5,.8,.99,1],v="-64px 0px 0px 0px",g={rootMargin:v,threshold:b},P={rootMargin:v,threshold:d.iM},S=Object.freeze({LOADING:0,PLAYING:1,PAUSED:2,STALLING:3});function f(){return(new Date).getTime()}function w(e){return!!e.volume&&e.volume>0}class k extends i.Component{constructor(e){super(e),y(this,"videoWrapperRef",(0,i.createRef)()),y(this,"handleWindowResize",(()=>{if(!this.fullscreen){const e=this.getDimensions(),{height:t,width:a}=this.currentInterval;e.height!==t||e.width!==a?this.startNewInterval(e):(this.currentInterval.windowHeight=e.windowHeight,this.currentInterval.windowWidth=e.windowWidth)}})),y(this,"handlePlayheadDown",(({event:e})=>{const{onPlayheadDown:t}=this.props;this.setState({seeking:!0}),t&&t({event:e})})),y(this,"handlePlayheadUp",(({event:e})=>{const{onPlayheadUp:t}=this.props;this.setState({seeking:!1}),t&&t({event:e})})),y(this,"handleLoop",(()=>{this.videoTime=0})),y(this,"handleTimeChange",(e=>{const{seeking:t,ready:a}=this.state;if(!this.currentInterval.videoDuration)return;const i=1e3*e.time,s=function(e,t,a,i){if(e>t)return null;if(a<=0)return null;for(const s of i){const i=s*a;if(e<=i&&t>i)return s}return null}(this.videoTime,i,this.currentInterval.videoDuration,m);if("number"==typeof s&&this.props.playing&&!t&&a){const e=f();this.logVideoEvent(6906,{...this.currentInterval,startTime:e,endTime:e,videoStartTime:0,videoEndTime:0,quartile:Math.floor(4*s),quartilePercentValue:s})}this.videoTime=i,this.props.onTimeChange&&this.props.onTimeChange(e)})),y(this,"handleDurationChange",(e=>{this.currentInterval.videoDuration=1e3*e.duration,this.props.onDurationChange&&this.props.onDurationChange(e)})),y(this,"handleReady",(e=>{const{ready:t}=this.state;t||this.setState({ready:!0}),this.props.onReady&&this.props.onReady(e)})),y(this,"handleEnded",(e=>{this.logFourthQuartileEvent(),this.props.loop&&(this.startNewInterval(),this.currentInterval.videoStartTime=0),this.props.onEnded&&this.props.onEnded(e)})),y(this,"handleVisibilityChange",((e,t)=>{if(0===e.length)return;const a=e.slice(-1)[0],i=function(e,t){for(let a=0;a<t.length;a+=1){const i=t[a],s=t[a+1];if(null==s)return i;if(i<=e&&e<s)return i}return null}(Number.parseFloat(a.intersectionRatio.toFixed(2)),b);"number"==typeof i&&(this.visible=i>=.5),null==i||i===this.currentInterval.viewability||this.fullscreen||(0===i?this.startNewInterval({viewability:i,playbackState:S.PAUSED}):this.startNewInterval({viewability:i}))})),y(this,"handleFullscreenChange",(({event:e,fullscreen:t})=>{if(t){const{height:e,width:t}=window.screen;this.startNewInterval({height:e,width:t,windowHeight:e,windowWidth:t})}else t||this.startNewInterval(this.getDimensions());this.fullscreen=t,this.props.onFullscreenChange&&this.props.onFullscreenChange({event:e,fullscreen:t})})),y(this,"handleClose",(()=>{this.startNewInterval()})),y(this,"handleContextMenu",(e=>{e.preventDefault()})),this.state={ready:!1,seeking:!1};const t=f();this.handleWindowResize=n()(this.handleWindowResize,1e3),this.currentInterval={videoDuration:0,startTime:t,endTime:t,videoStartTime:0,videoEndTime:0,isAudible:w(e),playbackState:this.getPlaybackState(e,this.state),quartile:-1,quartilePercentValue:0,height:null,width:null,windowHeight:null,windowWidth:null,viewability:null},this.videoTime=0,this.fullscreen=!1,this.visible=null}componentDidMount(){this.currentInterval={...this.currentInterval,...this.getDimensions()},window.addEventListener("resize",this.handleWindowResize),window.addEventListener("beforeunload",this.handleClose)}componentDidUpdate(e,t){const a={};w(e)&&!w(this.props)?a.isAudible=!1:!w(e)&&w(this.props)&&(a.isAudible=!0);const i=this.getPlaybackState(this.props,this.state);this.getPlaybackState(e,t)!==i&&(a.playbackState=i),Object.keys(a).length>0&&this.startNewInterval(a)}componentWillUnmount(){window.removeEventListener("resize",this.handleWindowResize),window.removeEventListener("beforeunload",this.handleClose),this.startNewInterval()}getPlaybackState(e,t){return t.ready?e.playing&&!t.seeking?S.PLAYING:S.PAUSED:S.LOADING}getDimensions(){let e,t;if(this.videoWrapperRef.current){const a=this.videoWrapperRef.current;a.clientHeight&&a.clientWidth&&(e=a.clientHeight,t=a.clientWidth)}return{height:e,width:t,windowHeight:window.innerHeight,windowWidth:window.innerWidth}}logVideoEvent(e,t){const{closeupStoryPinViewability:a,contextLogData:i,logContextEvent:s}=this.props,{height:n,width:o,windowHeight:l,windowWidth:d,viewability:h,...c}=t;if(null!=n&&null!=o&&null!=l&&null!=d&&null!=h){const t={...c,height:n,width:o,windowHeight:l,windowWidth:d,viewability:a||h};s({event_type:e,...r({...i,view:this.fullscreen?108:i.view,eventData:{videoEvent:t}})})}}logFourthQuartileEvent(){const e=f();this.logVideoEvent(6906,{...this.currentInterval,startTime:e,endTime:e,videoStartTime:0,videoEndTime:0,quartile:4,quartilePercentValue:1})}startNewInterval(e){const t=f();this.logVideoEvent(6904,{...this.currentInterval,endTime:t,videoEndTime:this.videoTime}),this.currentInterval={...this.currentInterval,...e,startTime:t,videoStartTime:this.videoTime,endTime:-1,videoEndTime:-1}}render(){const{accessibilityMaximizeLabel:e,accessibilityMinimizeLabel:t,accessibilityMuteLabel:a,accessibilityPauseLabel:i,accessibilityPlayLabel:s,accessibilityProgressBarLabel:n,accessibilityUnmuteLabel:r,aspectRatio:d,backgroundColor:h,captions:y,contextLogData:m,controls:b,cropHeight:v,hlsConfig:S,inAdsDesktopVideoExperiment:f,isAutoPlay:w,loop:k,objectFit:D,onLoadedChange:C,onControlsPause:T,onControlsPlay:E,onSeek:L,onVolumeChange:R,playbackRate:I,playing:V,playsInline:_,poster:x,preload:M,rootMargin:A,src:N,surface:F,videoStartTime:O,volume:W}=this.props,{seeking:U}=this.state,B=f?P:g;return void 0!==A&&(B.rootMargin=F?(0,l.e)(F):A),(0,p.jsx)(o.Z,{options:B,onVisibilityChange:this.handleVisibilityChange,children:(0,p.jsx)(u.xu,{ref:this.videoWrapperRef,onContextMenu:this.handleContextMenu,dangerouslySetInlineStyle:{__style:v?{display:"flex",alignItems:"center",height:`${v}px`}:{}},children:(0,p.jsx)(c.default,{accessibilityMaximizeLabel:e,accessibilityMinimizeLabel:t,accessibilityMuteLabel:a,accessibilityPauseLabel:i,accessibilityPlayLabel:s,accessibilityProgressBarLabel:n,accessibilityUnmuteLabel:r,aspectRatio:v?236/v:d,backgroundColor:h,captions:y,contextLogData:m,controls:b,hlsConfig:S,isAutoPlay:w,loop:k,objectFit:D,onDurationChange:this.handleDurationChange,onEnded:this.handleEnded,onFullscreenChange:this.handleFullscreenChange,onLoadedChange:C,onLoop:this.handleLoop,onControlsPause:T,onControlsPlay:E,onPlayheadDown:this.handlePlayheadDown,onPlayheadUp:this.handlePlayheadUp,onReady:this.handleReady,onSeek:L,onTimeChange:this.handleTimeChange,onVolumeChange:R,playbackRate:I,playing:!U&&V,onPlay:()=>{},onPlayError:()=>{},playsInline:_,poster:x,preload:M,src:N,videoStartTime:O,visible:this.visible,volume:W})})})}}function D(e){const{logContextEvent:t}=(0,h.v)();return(0,p.jsx)(k,{...e,logContextEvent:t})}y(k,"defaultProps",u.nk.defaultProps)},158103:(e,t,a)=>{a.r(t),a.d(t,{VideoWrapper:()=>w,default:()=>k,getPlaylistSourceSrc:()=>f});var i=a(667294),s=a(19121),n=a(965900),o=a(407043),r=a(773285),l=a(858416),d=a(780280),h=a(883119),c=a(969315),u=a(179888),p=a(785893);function y(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function m(e,t){if(!e||void 0===e)return"undefined";if("string"==typeof e){let a=e;if(t){const i="control"===t?"v3.pinimg.com":"v2.pinimg.com";a=e.replace("v1.pinimg.com",i)}return a}if(Array.isArray(e)&&e[0].src){let a=e[0].src;if(t){const e="control"===t?"v3.pinimg.com":"v2.pinimg.com";a=a.replace("v1.pinimg.com",e)}return a}return"unsupported_type_"+typeof e}class b extends i.Component{constructor(...e){super(...e),y(this,"state",{canPlayVideo:!1,playbackState:u.Cy.DEFAULT}),y(this,"errorRetryCount",2),y(this,"hasSegmentStarted",!1),y(this,"hasPlaybackStarted",!1),y(this,"hasVideoSessionStarted",!1),y(this,"hasVideoSessionEnded",!1),y(this,"lastStallTime",null),y(this,"lastPauseTime",null),y(this,"logSessionStartOnNextPlay",!1),y(this,"playerId",""),y(this,"videoSessionId",""),y(this,"videoVisibleTime",null),y(this,"playbackPerformance",{canPlayTime:null,detailedErrors:"",errorCode:0,errorName:"",errorReason:"",hasFatalError:!1,loadStartTime:null,numberOfStalls:0,numberOfSeeks:0,playbackStartTimestamp:null,segments:[],srcString:m(this.props.src,this.props.quicExpGroup),totalStallDurationMs:0,totalPauseDurationMs:0}),y(this,"componentDidMount",(()=>{const{contextLogData:e={},playing:t}=this.props,{is_closeup_video:a=!1}=e;(0,c.tE)("videoMounted",!1,a),t&&(this.videoVisibleTime=new Date,this.logPlaybackPerformance(u.DR,{initiator:"mount"}))})),y(this,"componentDidUpdate",(e=>{const{playing:t,visible:a,appInFocus:i}=this.props;e.appInFocus&&!i&&(this.logPlaybackPerformance(u.$f,{initiator:"update"}),this.logSessionStartOnNextPlay=!0),e.visible&&!1===a&&(this.logSessionStartOnNextPlay=!1,this.updatePauseDuration(),this.logPlaybackPerformance(u.$f,{initiator:"update"})),!1===e.visible&&!0===a&&(this.videoVisibleTime=this.videoVisibleTime||new Date,t?(this.setPlaybackStartTime(),this.setLastSegmentStartPlayTime(),this.setLastSegmentPlaybackStartDate(),this.logPlaybackPerformance(u.DR,{initiator:"update"})):this.logSessionStartOnNextPlay=!0),t&&i&&this.logSessionStartOnNextPlay&&(this.setPlaybackStartTime(),this.setLastSegmentStartPlayTime(),this.setLastSegmentPlaybackStartDate(),this.logPlaybackPerformance(u.DR,{initiator:"update"}),this.logSessionStartOnNextPlay=!1)})),y(this,"addSegment",(()=>{const{canPlayTime:e,loadStartTime:t,segments:a,srcString:i}=this.playbackPerformance;let s=-1;e&&t&&0===a.length&&(s=e>t?e-t:0);const n=this.videoPlayerRef&&this.videoPlayerRef.video,o={indicatedKbps:-1,duration:n&&n.duration*u.gJ||-1,lastStartPlayTime:null,level:-1,numServerAddressChange:-1,observedKbps:-1,playbackStartDate:null,serverAddress:"",sourceWidth:-1,sourceHeight:-1,startupTimeMs:s,switchBitrateKbps:-1,uri:i,viewportWidth:n&&n.clientWidth||-1,viewportHeight:n&&n.clientHeight||-1,watchedDurationMs:0};a.push(o)})),y(this,"getCurrentVideoTime",(()=>this.videoPlayerRef&&this.videoPlayerRef.video?this.videoPlayerRef.video.currentTime*u.gJ:0)),y(this,"getVideoResourceTiming",(()=>{var e,t;if(null!==(e=window)&&void 0!==e&&null!==(t=e.performance)&&void 0!==t&&t.getEntriesByName&&this.playbackPerformance.srcString){const e=window.performance.getEntriesByName(this.playbackPerformance.srcString);return e.length>0&&e[0]||null}return null})),y(this,"handleCanPlayVideo",(e=>{const{contextLogData:t={},onReady:a,playing:i}=this.props,{is_closeup_video:s=!1}=t,{canPlayVideo:n}=this.state;(0,c.tE)("handleCanPlayVideo",!1,s,{firstCanPlayEvent:!n,playing:i}),this.playbackPerformance.hasFatalError=!1,n||(this.playbackPerformance.canPlayTime=new Date),this.setState({canPlayVideo:!0}),a&&a(e)})),y(this,"handleEnded",(e=>{const{loop:t,onEnded:a}=this.props,{segments:i}=this.playbackPerformance,s=i&&i[i.length-1];t&&this.videoPlayerRef&&this.videoPlayerRef.video?(this.updateWatchDurationForCurrentSegment(),s&&(s.lastStartPlayTime=0),this.hasSegmentStarted=!1):t||this.logPlaybackPerformance(u.$f,{initiator:"videoEnded",loop:t}),this.setState({playbackState:u.Cy.ENDED}),a&&a(e)})),y(this,"handleError",(()=>{var e,t,a,i,s,n,o,r;const{contextLogData:l={}}=this.props,{is_closeup_video:d=!1}=l,h=this.videoPlayerRef&&this.videoPlayerRef.video;(null==h||null===(e=h.error)||void 0===e?void 0:e.code)!==u.lG.MEDIA_ERR_ABORTED&&(this.playbackPerformance.hasFatalError=!0),this.playbackPerformance.detailedErrors+=`${this.playbackPerformance.detailedErrors.length>0?", ":""}${(null==h||null===(t=h.error)||void 0===t?void 0:t.message)||""}`,this.playbackPerformance.errorCode=(null==h||null===(a=h.error)||void 0===a?void 0:a.code)||0,this.playbackPerformance.errorName=(null==h||null===(i=h.error)||void 0===i||null===(s=i.message)||void 0===s?void 0:s.slice(0,100))||"unknown",this.playbackPerformance.errorReason=(null==h||null===(n=h.error)||void 0===n||null===(o=n.message)||void 0===o?void 0:o.slice(0,100))||"unknown";const p={errorName:this.playbackPerformance.errorCode,errorReason:this.playbackPerformance.errorName,errorRetryCount:this.errorRetryCount,playbackState:this.state.playbackState,networkState:(null==h?void 0:h.networkState)||"unknown"};switch((0,c.tE)("fatalError",!1,d,p),null==h||null===(r=h.error)||void 0===r?void 0:r.code){case u.lG.MEDIA_ERR_ABORTED:break;case u.lG.MEDIA_ERR_NETWORK:case u.lG.MEDIA_ERR_DECODE:case u.lG.MEDIA_ERR_SRC_NOT_SUPPORTED:default:this.errorRetryCount>0&&(null==h||h.load(),this.errorRetryCount-=1)}this.updateWatchDurationForCurrentSegment(),this.setState({playbackState:u.Cy.FAILED})})),y(this,"handleLoadedMetadata",(()=>{this.setState({playbackState:u.Cy.LOADED_METADATA})})),y(this,"handleLoadStart",(()=>{this.playbackPerformance.loadStartTime=new Date,this.setState({playbackState:u.Cy.LOAD_START})})),y(this,"handleLoadedData",(()=>{this.setState({playbackState:u.Cy.LOADED_DATA})})),y(this,"handlePlaying",(()=>{this.playbackPerformance.hasFatalError=!1,this.setPlaybackStartTime(),this.hasSegmentStarted||this.addSegment(),this.setLastSegmentStartPlayTime(),this.setLastSegmentPlaybackStartDate(),this.updateStallDuration(),this.updatePauseDuration(),this.setState({playbackState:u.Cy.PLAYING}),this.props.clearSeekTime&&this.props.clearSeekTime()})),y(this,"handleUserPause",(e=>{const{onControlsPause:t}=this.props;this.lastPauseTime=new Date,t&&t(e)})),y(this,"handleVideoPause",(()=>{this.state.playbackState!==u.Cy.STALLING&&this.state.playbackState!==u.Cy.SEEKING&&(this.updateWatchDurationForCurrentSegment(),this.lastPauseTime||this.updateStallDuration()),this.setState({playbackState:u.Cy.PAUSED})})),y(this,"handleSeeking",(()=>{this.playbackPerformance.numberOfSeeks+=1;const{segments:e}=this.playbackPerformance,t=e&&e[e.length-1];t&&(t.lastStartPlayTime=null),this.state.playbackState!==u.Cy.ENDED&&this.setState({playbackState:u.Cy.SEEKING})})),y(this,"handleStalled",(()=>{null===this.lastStallTime&&this.state.playbackState!==u.Cy.ENDED&&(this.lastStallTime=new Date,this.playbackPerformance.numberOfStalls+=1,this.setState({playbackState:u.Cy.STALLING}))})),y(this,"handleTimeUpdate",(e=>{const{onTimeChange:t}=this.props;t&&t(e),this.state.playbackState===u.Cy.PLAYING&&(this.updateWatchDurationForCurrentSegment(),this.setLastSegmentStartPlayTime())})),y(this,"resetPlaybackMetrics",(()=>{this.hasSegmentStarted=!0,this.hasPlaybackStarted=!1,this.hasVideoSessionStarted=!1,this.hasVideoSessionEnded=!0,this.lastStallTime=null,this.lastPauseTime=null,this.videoSessionId="",this.videoVisibleTime=null,this.logSessionStartOnNextPlay=!1;const e={...this.playbackPerformance.segments[this.playbackPerformance.segments.length-1],lastStartPlayTime:null,playbackStartDate:null,watchedDurationMs:0};this.playbackPerformance.detailedErrors="",this.playbackPerformance.errorCode=0,this.playbackPerformance.errorName="",this.playbackPerformance.errorReason="",this.playbackPerformance.hasFatalError=!1,this.playbackPerformance.numberOfStalls=0,this.playbackPerformance.numberOfSeeks=0,this.playbackPerformance.playbackStartTimestamp=null,this.playbackPerformance.totalStallDurationMs=0,this.playbackPerformance.segments=[e]})),y(this,"setLastSegmentStartPlayTime",(()=>{const{segments:e}=this.playbackPerformance,t=e&&e[e.length-1];t&&null===t.lastStartPlayTime&&(t.lastStartPlayTime=this.getCurrentVideoTime())})),y(this,"setLastSegmentPlaybackStartDate",(()=>{const{segments:e}=this.playbackPerformance,t=e&&e[e.length-1];t&&null===t.playbackStartDate&&(t.playbackStartDate=Date.now())})),y(this,"setPlaybackStartTime",(()=>{this.hasPlaybackStarted||(this.playbackPerformance.playbackStartTimestamp=Date.now(),this.hasPlaybackStarted=!0)})),y(this,"setVideoPlayerRef",(e=>{const{setVideoRef:t}=this.props;if(e&&(t&&t(e),this.videoPlayerRef=e,this.videoPlayerRef.video)){const e=this.videoPlayerRef.video;e.addEventListener("loadedmetadata",this.handleLoadedMetadata),e.addEventListener("loadeddata",this.handleLoadedData),e.addEventListener("pause",this.handleVideoPause),e.readyState>=3&&(this.setState({canPlayVideo:!0}),this.playbackPerformance.canPlayTime=new Date)}})),y(this,"updateStallDuration",(()=>{if(null!==this.lastStallTime){const e=this.lastStallTime;this.playbackPerformance.totalStallDurationMs+=new Date-e,this.lastStallTime=null}})),y(this,"updatePauseDuration",(()=>{if(null!==this.lastPauseTime){const e=this.lastPauseTime;this.playbackPerformance.totalPauseDurationMs+=new Date-e,this.lastPauseTime=null}})),y(this,"updateWatchDurationForCurrentSegment",(()=>{const{segments:e}=this.playbackPerformance,t=e&&e[e.length-1],a=t?t.lastStartPlayTime:null,i=this.getCurrentVideoTime();if(t&&null!==a&&"number"==typeof i&&"number"==typeof a){const e=i-a;e>0&&(t.watchedDurationMs+=e,t.lastStartPlayTime=null)}})),y(this,"logPlaybackPerformance",((e,t)=>{const{contextLogData:a={},userId:i,isAutoPlay:s,logContextEvent:n}=this.props,{is_closeup_video:o=!1}=a,{canPlayTime:r,detailedErrors:l,errorCode:d,errorName:h,errorReason:p,hasFatalError:y,loadStartTime:m,totalPauseDurationMs:b,totalStallDurationMs:v,numberOfStalls:g,numberOfSeeks:P,playbackStartTimestamp:S,segments:f,srcString:w}=this.playbackPerformance,k=this.videoPlayerRef&&this.videoPlayerRef.video,D=e===u.DR,C=D&&!this.hasVideoSessionStarted,T=!D&&!this.hasVideoSessionEnded&&this.hasVideoSessionStarted;if(k&&(C||T)){var E;let C=-1;r&&m&&(C=r>m?r-m:0);let T=-1;r&&this.videoVisibleTime&&(T=r>this.videoVisibleTime?r-this.videoVisibleTime:0),D&&(this.videoSessionId=(0,u.Y7)(i),this.playerId=this.playerId||(0,u.EB)());const L=this.getVideoResourceTiming(),R={averageVideoKbps:-1,autoplaying:s,detailedErrors:l,downloadedKiloBytes:"number"==typeof(null==L?void 0:L.decodedBodySize)&&L.decodedBodySize/u.Fm||0,errorCode:d,errorName:h,errorReason:p,fatalError:y,isCellular:!1,nativeVideoDurationMs:k.duration*u.gJ||-1,numberOfStalls:g,numberOfSeeks:P,overallPausedDurationMs:b,overallBufferDurationMs:v,overallWatchedDurationMs:-1,rebufferRate:-1,playbackSessionId:this.videoSessionId,playbackStartTimestamp:S||-1,segments:[],sessionMark:e,screenPixelScale:null!==(E=window)&&void 0!==E&&E.devicePixelRatio?window.devicePixelRatio:-1,startupPlayerWidth:k.clientWidth,startupPlayerHeight:k.clientHeight,startupTimeMs:C,startupLatencyMs:T,startupVariantKbps:-1,startupVariantWatchedDurationMs:-1,startupVariantWidth:k.videoWidth,startupVariantHeight:k.videoHeight,videoUrl:w};if(!D){this.updateWatchDurationForCurrentSegment(),this.updateStallDuration();const e=f.reduce(((e,t)=>e+(t.watchedDurationMs||0)),0);R.overallWatchedDurationMs=e,R.startupVariantWatchedDurationMs=e,R.segments=this.playbackPerformance.segments,0===e?(R.errorName="invalid_watch_duration",R.rebufferRate=-1):R.rebufferRate=v/e}(0,c.ZP)(R,!1,o,{playbackState:this.state.playbackState,...t});const{view:I,viewParameter:V,component:_,element:x,objectId:M,...A}=a;n({event_type:3606,event_data:{videoPerformanceData:R},view_type:I,view_parameter:V,component:_,element:x,object_id_str:M,aux_data:{...A,is_closeup_video:o,playback_session_id:this.videoSessionId}}),D?(this.hasVideoSessionStarted=!0,this.hasVideoSessionEnded=!1):this.resetPlaybackMetrics(),(0,c.tE)(D?"sessionStart":"sessionEnd",!1,o,{playbackState:this.state.playbackState,...t})}}))}componentWillUnmount(){const{loop:e}=this.props;this.updatePauseDuration(),this.logPlaybackPerformance(u.$f,{initiator:"unmount",loop:e})}render(){const{accessibilityMaximizeLabel:e,accessibilityMinimizeLabel:t,accessibilityMuteLabel:a,accessibilityPauseLabel:i,accessibilityPlayLabel:s,accessibilityProgressBarLabel:n,accessibilityUnmuteLabel:o,aspectRatio:r,captions:l,controls:d,loop:c,loopOverride:u,objectFit:y,onDurationChange:b,onFullscreenChange:v,onLoadedChange:g,onControlsPlay:P,onPlayheadDown:S,onPlayheadUp:f,onSeek:w,onVolumeChange:k,playbackRate:D,playing:C,playsInline:T,poster:E,preload:L,src:R,videoStartTime:I,volume:V}=this.props,{canPlayVideo:_}=this.state;return(0,p.jsx)(h.nk,{autoplay:_&&C,accessibilityMaximizeLabel:e,accessibilityMinimizeLabel:t,accessibilityMuteLabel:a,accessibilityPauseLabel:i,accessibilityPlayLabel:s,accessibilityProgressBarLabel:n,accessibilityUnmuteLabel:o,aspectRatio:r,captions:l,controls:d,loop:void 0===u?c:u,objectFit:y,onDurationChange:b,onEnded:this.handleEnded,onError:this.handleError,onFullscreenChange:v,onLoadedChange:g,onLoadStart:this.handleLoadStart,onControlsPause:this.handleUserPause,onControlsPlay:P,onPlaying:this.handlePlaying,onPlayheadDown:S,onPlayheadUp:f,onReady:this.handleCanPlayVideo,onSeek:w,onSeeking:this.handleSeeking,onStalled:this.handleStalled,onTimeChange:this.handleTimeUpdate,onVolumeChange:k,onWaiting:this.handleStalled,playbackRate:D,onPlay:()=>{},onPlayError:()=>{},playing:_&&C,playsInline:T,poster:E,preload:L,ref:this.setVideoPlayerRef,src:m(R,this.props.quicExpGroup),startTime:I||void 0,volume:V})}}const v=(0,i.memo)((function(e){const{logContextEvent:t}=(0,o.v)(),{country:a,isAuthenticated:i,isBot:h,isSocialBot:u,unauthId:y,userAgent:m}=(0,d.B)(),{browserName:v,browserVersion:g,isMobile:P}=m,{contextLogData:S={}}=e,{is_closeup_video:f=!1,view:w,viewParameter:k}=S,{appUI:{appInFocus:D}}=(0,n.I)(),{checkExperiment:C}=(0,r.F)(),{clearSeekTime:T}=(0,l.RC)();let E=null;i&&(E=C("web_video_quic").group.length?C("web_video_quic").group:null);const L=(0,s.Z)(),R={browserName:v,browserVersion:g,country:a,isAuthenticated:i,isBot:h,is_closeup_video:f,isMobile:P,isSocialBot:u,view:w,viewParameter:k};return(0,c.r$)(R),(0,p.jsx)(b,{...e,userId:L.id||y,appInFocus:D,quicExpGroup:E,logContextEvent:t,clearSeekTime:T})}));var g=a(562559),P=a(366284);function S(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const f=e=>{if(Array.isArray(e)){const t=e.find((e=>"video/m3u8"===e.type));return t?t.src:void 0}return RegExp("m3u8$").test(e)?e:void 0};class w extends i.PureComponent{constructor(e){super(e),S(this,"componentDidUpdate",((e,t)=>{var a;e.videoStartTime&&this.props.videoStartTime&&e.videoStartTime<this.props.videoStartTime&&null!==(a=this.videoPlayerRef)&&void 0!==a&&a.video&&(this.videoPlayerRef.video.currentTime=this.props.videoStartTime)})),S(this,"setVideoPlayerRef",(e=>{e&&(this.videoPlayerRef=e)})),S(this,"handleOnEnded",(({event:e})=>{const{loop:t,onLoop:a,onEnded:i}=this.props;i&&(i({event:e}),this.videoPlayerRef&&this.videoPlayerRef.video&&t&&(this.videoPlayerRef.video.play(),a&&a()))}));const t=f(e.src);this.state={useHlsVideo:!e.preferMp4&&!(0,P.G6)(e.requestContext.userAgent.browserName)&&!!t}}render(){const{accessibilityMaximizeLabel:e,accessibilityMinimizeLabel:t,accessibilityMuteLabel:a,accessibilityPauseLabel:i,accessibilityPlayLabel:s,accessibilityProgressBarLabel:n,accessibilityUnmuteLabel:o,aspectRatio:r,appInFocus:l,backgroundColor:d,captions:h,contextLogData:c,controls:u,hlsConfig:y,isAutoPlay:m,loop:b,objectFit:P,onDurationChange:S,onEnded:w,onFullscreenChange:k,onLoadedChange:D,onControlsPause:C,onControlsPlay:T,onPlayheadDown:E,onPlayheadUp:L,onReady:R,onSeek:I,onTimeChange:V,onVolumeChange:_,playbackRate:x,playing:M,playsInline:A,poster:N,preferMp4:F,preload:O,src:W,videoStartTime:U,visible:B,volume:H}=this.props,{useHlsVideo:j}=this.state,z=f(W),q={...y,startPosition:U||-1},G=!w&&b;return j&&z?(0,p.jsx)(g.Z,{accessibilityMaximizeLabel:e,accessibilityMinimizeLabel:t,accessibilityMuteLabel:a,accessibilityPauseLabel:i,accessibilityPlayLabel:s,accessibilityProgressBarLabel:n,accessibilityUnmuteLabel:o,aspectRatio:r,appInFocus:l,backgroundColor:d,captions:h,contextLogData:c,controls:u,hlsConfig:q,isAutoPlay:m,loop:b,loopOverride:G,onDurationChange:S,onEnded:this.handleOnEnded,onFullscreenChange:k,onLoadedChange:D,onControlsPause:C,onControlsPlay:T,onPlayheadDown:E,onPlayheadUp:L,onReady:R,onSeek:I,onTimeChange:V,onVolumeChange:_,playbackRate:x,onPlay:()=>{},onPlayError:()=>{},playing:M,playsInline:A,poster:N,preload:O,setVideoRef:this.setVideoPlayerRef,src:z,visible:B,volume:H}):(0,p.jsx)(v,{accessibilityMaximizeLabel:e,accessibilityMinimizeLabel:t,accessibilityMuteLabel:a,accessibilityPauseLabel:i,accessibilityPlayLabel:s,accessibilityProgressBarLabel:n,accessibilityUnmuteLabel:o,aspectRatio:r,captions:h,contextLogData:c,controls:u,isAutoPlay:m,loop:b,loopOverride:G,objectFit:P,onDurationChange:S,onEnded:this.handleOnEnded,onFullscreenChange:k,onLoadedChange:D,onControlsPause:C,onControlsPlay:T,onPlayheadDown:E,onPlayheadUp:L,onReady:R,onSeek:I,onTimeChange:V,onVolumeChange:_,playbackRate:x,onPlay:()=>{},onPlayError:()=>{},playing:M,playsInline:A,poster:N,preload:O,setVideoRef:this.setVideoPlayerRef,src:F?W:z||W,videoStartTime:U,visible:B,volume:H})}}function k(e){const{appUI:{appInFocus:t}}=(0,n.I)(),a=(0,d.B)();return(0,p.jsx)(w,{...e,appInFocus:t,requestContext:a})}}}]);
//# sourceMappingURL=https://sm.pinimg.com/webapp/26749-2f734feaf085a3d0.mjs.map